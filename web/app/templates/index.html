{% extends "base.html" %}

{% block content %}
<div class="container">

    <!-- Hero de bienvenida -->
    <section class="dashboard-hero card">
        <h1 class="dashboard-title">Bienvenido al Sistema Grupo CS</h1>
        <p class="dashboard-subtitle">
            Plataforma interna para la gesti√≥n de <strong>trabajadores</strong>, <strong>contratos</strong>,
            <strong>obras</strong> y futuros m√≥dulos de <strong>prevenci√≥n de riesgos</strong>.
        </p>
        <p class="dashboard-subtitle">
            Selecciona una de las √°reas para comenzar a trabajar.
        </p>
    </section>

    <!-- Mini dashboard de trabajadores -->
    {% if trabajadores is defined %}
    <section class="dashboard-kpis">
        <div class="kpi-card">
            <span class="kpi-label">Trabajadores registrados</span>
            <span class="kpi-value">{{ trabajadores|length }}</span>
        </div>

        <!-- Espacios reservados para futuras m√©tricas -->
        <div class="kpi-card kpi-muted">
            <span class="kpi-label">Activos (pr√≥ximamente)</span>
            <span class="kpi-value">-</span>
        </div>

        <div class="kpi-card kpi-muted">
            <span class="kpi-label">Con contratos vigentes (pr√≥ximamente)</span>
            <span class="kpi-value">-</span>
        </div>
    </section>
    {% endif %}


    <!-- Tarjetas de navegaci√≥n principal -->
    <section class="dashboard-grid">
        <!-- Trabajadores -->
        <article class="card dashboard-card">
            <h2 class="card-title">Gesti√≥n de Trabajadores</h2>
            <p class="card-subtitle">
                Consulta fichas, crea nuevos trabajadores y revisa informaci√≥n contractual asociada.
            </p>
            <div class="dashboard-actions">
                <a href="{{ url_for('core.index') }}#trabajadores" class="btn btn-primary">
                    Ver trabajadores
                </a>
                <a href="/trabajadores/nuevo" class="btn btn-secondary">
                    Nuevo trabajador
                </a>
            </div>
        </article>

        <!-- Contratos -->
        <article class="card dashboard-card">
            <h2 class="card-title">Gesti√≥n de Contratos</h2>
            <p class="card-subtitle">
                Crea, revisa y administra contratos de trabajo asociados a los distintos trabajadores.
            </p>
            <div class="dashboard-actions">
                <a href="/contratos/" class="btn btn-primary">
                    Ver contratos
                </a>
            </div>
        </article>

        <!-- Obras -->
        <article class="card dashboard-card">
            <h2 class="card-title">Gesti√≥n de Obras</h2>
            <p class="card-subtitle">
                Administra las obras activas, asigna trabajadores y centraliza informaci√≥n relevante.
            </p>
            <div class="dashboard-actions">
                <a href="/obras/" class="btn btn-primary">
                    Ver obras
                </a>
            </div>
        </article>

        <!-- Prevenci√≥n (futuro m√≥dulo) -->
        <article class="card dashboard-card">
            <h2 class="card-title">Prevenci√≥n de Riesgos</h2>
            <p class="card-subtitle">
                M√≥dulo en construcci√≥n para integrar reportes, investigaciones de incidentes y documentaci√≥n preventiva.
            </p>
            <div class="dashboard-actions">
                <button type="button" class="btn btn-secondary" disabled>
                    Pr√≥ximamente
                </button>
            </div>
        </article>
    </section>

    <!-- Secci√≥n opcional: listado de trabajadores en la misma p√°gina -->
    {% if trabajadores is defined %}
    <section id="trabajadores" class="page">
    <div class="card">
        <div class="card-header">
            <div>
                <h2 class="card-title">Trabajadores</h2>
                <p class="card-subtitle">
                    Listado de trabajadores actualmente registrados en el sistema.
                </p>
            </div>
            <a href="/trabajadores/nuevo" class="btn btn-primary">Agregar trabajador</a>
        </div>

        <!-- Filtros -->
        <form method="get" class="filter-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="obra">Obra</label>
                    <select name="obra" id="obra">
                        <option value="">Todas las obras</option>
                        {% for obra in obras %}
                            <option value="{{ obra }}"
                                {% if obra_seleccionada == obra %}selected{% endif %}>
                                {{ obra }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="cargo">Cargo</label>
                    <select name="cargo" id="cargo">
                        <option value="">Todos los cargos</option>
                        {% for cargo in cargos %}
                            <option value="{{ cargo }}"
                                {% if cargo_seleccionado == cargo %}selected{% endif %}>
                                {{ cargo }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Aplicar filtros</button>
                <a href="{{ url_for('core.index') }}" class="btn btn-secondary">Limpiar</a>
            </div>
        </form>


            {% if trabajadores %}
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>RUT</th>
                                <th>Nombre</th>
                                <th>Cargo</th>
                                <th>Obra</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for t in trabajadores %}
                            <tr>
                                <td>{{ t.rut }}</td>
                                <td>{{ t.nombres }} {{ t.ap_paterno }} {{ t.ap_materno }}</td>
                                <td>{{ t.cargo or "-" }}</td>
                                <td>{{ t.obra.nombre or "-" }}</td>
                                <td>
                                    <a href="{{ url_for('trabajadores.detalle_trabajador', trabajador_id=t.id) }}"
                                       class="btn btn-secondary">
                                        Ver ficha
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                                {% if total_pages > 1 %}
                                <div class="pagination-wrapper">
                                    <nav class="pagination">
                                        {% if page > 1 %}
                                            <a href="{{ url_for('core.index', page=page-1, obra=obra_seleccionada, cargo=cargo_seleccionado) }}"
                                            class="page-link">
                                                üîô Anterior
                                            </a>
                                        {% endif %}

                                        {% for p in range(1, total_pages + 1) %}
                                            {% if p == page %}
                                                <span class="page-link current">{{ p }}</span>
                                            {% else %}
                                                <a href="{{ url_for('core.index', page=p, obra=obra_seleccionada, cargo=cargo_seleccionado) }}"
                                                class="page-link">
                                                    {{ p }}
                                                </a>
                                            {% endif %}
                                        {% endfor %}

                                        {% if page < total_pages %}
                                            <a href="{{ url_for('core.index', page=page+1, obra=obra_seleccionada, cargo=cargo_seleccionado) }}"
                                            class="page-link">
                                                Siguiente üîú
                                            </a>
                                        {% endif %}
                                    </nav>
            </div>
            {% endif %}

                </div>
            {% else %}
                <p class="empty-state">
                    No hay trabajadores registrados a√∫n. Puedes crear uno nuevo con el bot√≥n
                    <strong>‚ÄúAgregar trabajador‚Äù</strong>.
                </p>
            {% endif %}
        </div>
    </section>
    {% endif %}

</div>
{% endblock %}
